
		TOPPERS/FMPカーネル
		変更履歴

		対応バージョン: Release 1.1.1
		最終更新: 2010年05月12日

このドキュメントは，TOPPERS/FMPカーネルのRelease 0.A.0以降の変更履歴を，
新しい方から順に記述したものである．

----------------------------------------------------------------------
 TOPPERS/FMP Kernel
     Toyohashi Open Platform for Embedded Real-Time Systems/
     Flexible MultiProcessor Kernel

 Copyright (C) 2005-2010 by Embedded and Real-Time Systems Laboratory
             Graduate School of Information Science, Nagoya Univ., JAPAN
 
 上記著作権者は，以下の(1)〜(4)の条件を満たす場合に限り，本ソフトウェ
 ア（本ソフトウェアを改変したものを含む．以下同じ）を使用・複製・改
 変・再配布（以下，利用と呼ぶ）することを無償で許諾する．
 (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
     権表示，この利用条件および下記の無保証規定が，そのままの形でソー
     スコード中に含まれていること．
 (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
     用できる形で再配布する場合には，再配布に伴うドキュメント（利用
     者マニュアルなど）に，上記の著作権表示，この利用条件および下記
     の無保証規定を掲載すること．
 (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
     用できない形で再配布する場合には，次のいずれかの条件を満たすこ
     と．
   (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
       作権表示，この利用条件および下記の無保証規定を掲載すること．
   (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
       報告すること．
 (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
     害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．
     また，本ソフトウェアのユーザまたはエンドユーザからのいかなる理
     由に基づく請求からも，上記著作権者およびTOPPERSプロジェクトを
     免責すること．
 
 本ソフトウェアは，無保証で提供されているものである．上記著作権者お
 よびTOPPERSプロジェクトは，本ソフトウェアに関して，特定の使用目的
 に対する適合性も含めて，いかなる保証も行わない．また，本ソフトウェ
 アの利用により直接的または間接的に生じたいかなる損害に関しても，そ
 の責任を負わない．
 
 @(#) $Id: version.txt 618 2010-05-12 06:45:15Z ertl-honda $
----------------------------------------------------------------------
        TOPPERS/FMPカーネル
        Release 1.1.0 から 1.1.1 への変更点
        リリース日時 2010-05-12

○変更点のリスト
・システムログ出力の共有時のログタスクで使用するポート番号のマクロ
 （LOGTASK_PORTID_G_SYSLOG）を新設．

・EXCNO_VALIDにCPU番号を含むように変更．

・ターゲット依存部でCPUEXCxを定義しなかった場合は，サンプルプログラム
  で対応するCPU例外ハンドラを定義しないように変更．

・サンプルプログラムのグローバルタイマ方式のサポート

・TOPPERS_SUPPORT_MULTI_PRCマクロの追加

・init_wait_queue()の修正
  ・p_tcbからp_pcbを参照してた箇所をローカル変数のp_pcbを直接参照する
    ように変更．

・ras_tex()の修正
  ・get_my_p_pcb()をCPUロック外で取得していた問題を修正．
  ・無駄な変数（p_runtsk）の除去．

・t_rtskの次の起動時の割付けプロセッサのIDを格納するメンバ名の修正
  ・統合仕様書に合わせて，actprcidから，actprcに修正．

・システムログ出力のマイグレーション対応
  ・割込みロック後に使用するポートを取得するように変更．

・システムログ出力の共有対応
  ・スピンロックにより，プロセッサ間の排他制御を行うように変更．

○ターゲット依存部の修正が必要な変更点

----------------------------------------------------------------------
        TOPPERS/FMPカーネル
        Release 1.0.1 から 1.1.1 への変更点
        リリース日時 2010-02-08

○変更点のリスト
・barrier_sync()の修正
  どのような状態でも実行可能なように，プロセッサIDの取得に，
  sil_get_pid()を使用するように変更．

・ext_ker()の修正
  自プロセッサのPCBを割込み許可状態で参照していた問題を修正．  

・TPRC_NONE を追加
  ref_tsk() の戻り値のメンバーである actprc の取り得る値． 
  actprcの初期化はTPRC_NONEを設定するように変更．

・kernel_impl.hの修正
  #ifdef TOPPRES_ISTKPT を #ifdef TOPPERS_ISTKPT に修正．

・ter_tsk()の修正
  G_KLOCK時のコードで，p_runtskを使用していた問題を修正．

・ref_tsk()の修正
  次回起動時割付けプロセッサの情報を追加．

・rel_mpf()の修正
  オブジェクトロック解放時にディスパッチの必要性をチェックしていないバ
  グを修正．

・iset_flg()の修正
  タスクロックリリースしていない問題を修正．

・起動時にx_initialize_giant_lock()をマスタプロセッサのみが呼び出すよ
  うに変更．

・時間待ちタスクのマイグレーション時の時間の扱いを修正．
  基準時刻(current_time)から相対時間によって指定した以上の時間が経過し
  た後となるように変更．

・chg_pri/rel_waiのデッドロック回避時のロック取得のためのretryの戻り先
  の修正

・logtask.cでOS内部の関数，x_prc_index()を使用していた問題の修正
  sil_get_pid()に変更．

・mig_tskでマイグレーション先のプロセッサが同一プロセッサの場合の問題
  点を修正
  他タスクを指定した場合，同一優先度内で最低優先度となるように修正．
  さらに，同一優先度で最低優先順位となる内部関数を追加．

・mact_tskの要求がキューイングしている状態でmig_tskが発行された場合の
  問題点を修正
  
・ter_tskの問題点を修正
  リトライ時にCPUロック解除を行うパスがあったため修正．

・my_xxxマクロの廃止
  get_my_p_pcb()/get_mp_p_pcb()を代わりに使用

・ロックマクロをロック関数へ変更

・kernel.tf内で割込み番号，割込みハンドラ番号，例外番号の取得の冗長な
  記述を修正．
  ・INH.INHNO[inhno] → inhno
  ・INT.INTNO[intno] → intno
  ・EXC.EXCNO[excno] → excno 
 
・kernel_cfg.cのINTHDR/EXCHDR_ENTRYのハンドラ番号／CPU例外ハンドラ番号
  を16進へ変更

・割込み処理モデルの統合仕様書への追従
  上位ビットに，プロセッサIDのビットマスクではなく，プロセッサIDを設定
  するように変更．複数のプロセッサが受け付けられる割込み要求ラインは，
  上位ビットを0とする．

・slp_tsk/wup_tskの実行時間計測プログラムの追加

○ターゲット依存部の修正が必要な変更点

・SIL_LOC_SPNの仕様を変更．
  ロック取得を待つ間は，割込みをマスクしないように変更．

・非タスクコンテキスト用スタックのトップのアドレスが正しく算出していな
  い問題の修正
  非タスクコンテキスト用スタックのディフォルトのサイズ
  (TOPPERS_PRCx_ISTKSZ:xはプロセッサID) はバイト指定とする．

・TNUM_PRCをTNUM_PRCIDに変更

・SIL_LOC_SPNの仕様変更
  SIL_LOC_INTの機能を包含する．
  使用前には，SIL_PRE_LOC を記述する必要がある．

・スピンロックのターゲット依存部の関数の仕様変更
  ・ロックマクロの変更と同様に，依存部の関数内で割込みを許可するように
    変更．  
    void   t_lock_spin(SPNLOCK *p_spn_lock)
    void   i_lock_spin(SPNLOCK *p_spn_lock)
    bool_t try_lock_spin(SPNLOCK *p_spn_lock)

・ロックマクロをロック関数へ変更
  ・ロック取得関数を target_config.h ないしはそこからインクルードされ
    るファイルで定義する．
     void t_acquire_lock(LOCK *p_lock)
     bool_t t_acquire_nested_lock(LOCK *p_lock)
     void i_acquire_lock(LOCK *p_lock)
     bool_t i_acquire_nested_lock(LOCK *p_lock)
     void release_lock(LOCK *p_lock)
     void acquire_lock_without_preemption(LOCK *p_lock)
  ・ロックの型を LOCK のみとする．
  ・プロセッサロック・細粒度ロックの場合，割込みエントリー処理でロック
    を取得していれば解放する．

・プロセッサ毎に持つターゲット依存の情報のPCBへの統合
  ・target_pcb.h 及びそこからインクルードされるファイルを作成して，そ
    こに，以下内容を記載．target_config.hはインクルードしないこと．
    ・TPCB（target_processor_control_block）の定義
    ・ロックの型の定義
    ・カーネルロックの方式の指定
    ・x_prc_index()の定義

・割込み処理モデルの統合仕様書への追従
  割込み番号・割込みハンドラ番号の仕様を統合仕様書に合わせる．
  ・.cfg/.h/.c 中の割込み番号・割込みハンドラ番号の更新
    ・プロセッサ間割込み/タイマー/UART
  ・xxx.tfの更新
    ・INTNO_VALID，INHNO_VALID
    ・その他割込み番号の上位ビットをチェックしている箇所．

----------------------------------------------------------------------
        TOPPERS/FMPカーネル
        Release 1.0.1 から 1.0.2 への変更点
        リリース日時 2009-09-07

○変更点のリスト
・porting.txt の修正と追記

・CHECK_DISPATCH() 使用箇所の変更
  CHECK_TSKCTX_UNL() もしくは CHECK_INTCTX_UNL() に変更．
  タスクディスパッチ可能状態（dspflg）のチェックをCPUロック状態後にチ
  ェックするように変更．該当するAPIは以下の通り．

    dataqueue.c: snd_dtq()
    dataqueue.c: tsnd_dtq()
    dataqueue.c: rcv_dtq()
    dataqueue.c: trcv_dtq()

    eventflag.c: wai_flg()
    eventflag.c: twai_flg()

    mailbox.c: rcv_mbx()
    mailbox.c: trcv_mbx()

    mempfix.c: get_mpf()
    mempfix.c: tget_mpf()

    pridataq.c: snd_pdq()
    pridataq.c: tsnd_pdq()
    pridataq.c: rcv_pdq()
    pridataq.c: trcv_pdq()

    semaphore.c: wai_sem()
    semaphore.c: twai_sem()

    task_sync.c: slp_tsk()
    task_sync.c: tslp_tsk()
    task_sync.c: dly_tsk()

・CHECK_DISPATCH() の削除

・CHECK_TSKCTX_UNL()/CHECK_INTCTX_UNL() の変更
  sense_tskctx_unl()/sense_intctx_unl() を呼び出すように変更．

・sense_tskctx_unl()/sense_intctx_unl() の追加

・sense_context()/[tix]_sense_lock()のマイグレーション対応
  CPUロック解除状態で呼び出されるため，実行中にマイグレーションされて
  も問題ないように修正．具体的には，CPU ID を取得してCPU固有のデータを
  アクセスする箇所をCPUロック状態で実行するように変更．

・CHECK_NONSELF()の削除と使用箇所の修正
  割込み禁止前にチェックすると，マイグレーションされた場合に，異なるプ
  ロセッサの値を読み込む可能性があるため，CPUロック後にチェックするよ
  うに変更．該当するAPIは以下の通り．

   ・task_manage.c : ter_tsk() : ジャイアントロック用
   ・task_manage.c : ter_tsk() : プロセッサロック・細粒度ロック用

・CHECK_LOCSPN()の削除
  使用していないため削除．

----------------------------------------------------------------------
        TOPPERS/FMPカーネル
        Release 1.0.0 から 1.0.1 への変更点
        リリース日時 2009-07-17

○変更点のリスト

・test/test_mact_tsk{1,2,3} 及び test/test_mig_tsk{1,2}が動作しない問
  題を修正．

・ディスパッチ禁止状態のプロセッサのタスクからディスパッチ許可状態の別
  プロセッサに mrot_rdq してもローテートされない問題を修正

・call_texrtn()で他のタスクにディスパッチする際の問題を修正
  タスクロックを取得したいたまま，ディスパッチしていたため，解放して呼
  び出すように変更．

・改行コードをLFに統一

・「CPU例外番号」ないしは「例外番号」を「CPU例外ハンドラ番号」に統一

・imact_tskでプロセッサIDのチェックが抜けていた問題を修正

・プロセッサロック時のT_ACQUIRE_NESTED_LOCK_AND_CHECK_RUNNABLEの修正
  RUNNABLEでない場合にオブジェクトロックを解放していない問題を修正．

・msta_cycでTA_PHS属性でない周期ハンドラの起動時刻を起動位相に修正

・mact_tskにより起動要求がキューイングされたタスクを ter_tsk しても
  マイグレーションされない問題を修正
  make_dormant() で actprc を初期化しないように変更．
  actprc と actque を同じ箇所で初期化するように変更．

・バリア同期関連のコードのループ変数を volatile を付加

・ext_tskでマイグレーションする場合にマイグレーション要求がクリアされ
  ない問題を修正

・テストプログラム関連
 ・テストライブラリにバリア同期関数を追加
 ・チェックポイント表示時にプロセッサIDも同時に表示
 ・チェックポイント関数で全割込みロック前にプロセッサIDを取得していた問題を修正
 ・チェックポイント関数と完了チェックポイントでのPRCIDの取得をsil関数に変更
 ・test_spin_lock.c の修正．
   ・try_spn/itry_spnのロック取得失敗時のエラーコードがE_OBJに修正された
     ことに伴う修正
   ・全テスト終了時に check_finish() を呼び出すように修正．
 ・test_mact_tsk2.c の修正
   ・プロセッサ2で終了時に check_finish() を呼び出すように修正．
 ・CPU例外のテスト（シングルプロセッサ）を追加
 ・タスク例外のテスト（シングルプロセッサ）を追加
 ・セマフォのテスト（シングルプロセッサ）を追加
 ・システム状態に関するテスト（シングルプロセッサ）を追加

・sig_semの実行時間計測プログラムの追加

・ref_spnがCPUロック状態で正常終了する問題を修正
  E_CTXとなるように修正．  

・get_pid/iget_pidがCPUロック状態で正常終了する問題を修正
  E_CTXとなるように修正．  

・msta_alm()/imsta_alm()/msta_cyc()をTPRC_INI指定で発行すると E_ID が
  返る問題を修正

・imsta_alm() を TPRC_INI 指定で発行しても対象アラームハンドラが起動さ
  れない問題を修正

・スピンロックを取得した状態で，loc_cpu()/iloc_cpu()/unl_cpu() 
  /iunl_cpu()を発行すると E_CTX エラーとなる問題を修正
  状態は変更しないように修正．

・try_spn/itry_spnで既にロック獲得されている場合のエラーコードが 
  E_TMOUT になる問題の修正

・ref_spnで他コアからスピンロックの状態を参照できない問題を修正

・マクロ名の変更(TPRC_INIT -> TPRC_INI)

・unl_spn/iunl_spnのエラーコードの修正
  操作対象のスピンロックを獲得せずに unl_spn(), iunl_spn() した場合に 
  E_CTX エラーが返えっていたため，E_ILUSEが返るように修正．

・ena_int/dis_intのチェックに関する修正
  マイグレーションを考慮して，割込み禁止後に割込み番号のチェックを行う
  ように修正．

・sus_tskのロックマクロの変更
  自タスクが対象の場合は，他のsus_tskとレーシングすると，E_QOVR が返るこ
  とがある．

・T_ACQUIRE_NESTED_DUAL_LOCK_AND_CHECK_MIG()の修正
  CPUロックを取得していた問題を修正．
  
・wait_tmoutが使用するロックマクロの変更
  I_ACQUIRE_NESTED_LOCK() -> I_ACQUIRE_NESTED_LOCK_AND_CHECK_MIG()
  に修正．

・ext_tskの使用するロックマクロの変更
  T_ACQUIRE_TSK_LOCK_AND_CHECK_MIG(my_p_runtsk->p_pcb) -> 
  T_ACQUIRE_TSK_LOCK_AND_CHECK_RUNNABLE()
  に修正．

・sus_tskの使用するロックマクロの変更
  T_ACQUIRE_TSK_LOCK() -> T_ACQUIRE_TSK_LOCK_AND_CHECK_MIG()
  に修正．

・stp_cyc/ref_cycの使用するロックマクロの変更
  T_ACQUIRE_TSK_LOCK() -> T_ACQUIRE_TSK_LOCK_AND_CHECK_MIG
  に修正．

・mrot_rdqで使用するロックマクロの修正
  T_ACQUIRE_NESTED_LOCK_AND_CHECK_MIG() -> T_ACQUIRE_TSK_LOCK(p_pcb) 
  に修正．

・fsnd_dtqでの使用するロックマクロの修正
  I_ACQUIRE_NESTED_LOCK_AND_CHECK_MIG() -> T_ACQUIRE_NESTED_LOCK_AND_CHECK_MIG()
  に修正．

・can_wupでの使用するロックマクロの修正
  I_ACQUIRE_TSK_LOCK_AND_CHECK_MIG() -> T_ACQUIRE_TSK_LOCK_AND_CHECK_MIG() 
  に修正．

・別プロセッサに割り付けられている実行状態のタスクに対するref_tskを発行した
  場合の問題の修正．
  発行すると，状態としてTTS_RUNではなくTTS_RDYが返ってきていたため，
  TTS_RUNが返るように修正

・未使用の管理ブロックが生成される問題を修正
  各オブジェクトを使わない場合に kernel_cfg.c に生成される，
  以下のオブジェクトTOPPERS_EMPTY_LABEL()の引数が間違っていた．
   * セマフォ, イベントフラグ, データキュー, 優先度データキュー
     メールボックス, 固定長メモリプール, 周期ハンドラ, アラームハンドラ 

----------------------------------------------------------------------
        TOPPERS/FMPカーネル
        Release 0.B.0 から 1.0.0 への変更点
        リリース日時 2009-05-13

○変更点のリスト

・仕様変更のあった機能の列挙
  fmp_sepc.txt の一部機能の仕様変更を更新．

・rel_waiのエラーコードの修正
  デッドロック回避ルーチンで，対象タスクの待ちが解除された場合のエラー
  コードをE_OKからE_OBJに修正．

・ASP カーネル 1.4.0追従
  ・call_atexitの廃止
    ターゲット非依存部からcall_atexitを呼び出すのをやめる．
    call_atexitで行っていた処理（標準的にはsoftware_term_hookを呼び出
    す処理）は，必要であればtarget_exitの先頭で行うこととする．

  ・TSZ_MPFの定義を削除

  ・get_utmの問題の修正
    周期ハンドラ，アラームハンドラの中でget_utmを呼ぶと，正しい時刻が
    返らない問題を修正．

  ・実行時間分布集計モジュールの修正
    TNUM_HISTの定義を，histgram.hからhistgram.cに移動．

  ・トレースログ機能の改善
    LOG_TEX_ENTER，LOG_TEX_LEAVEのパラメータに，p_runtskを追加．

  ・clean時に削除するファイル
    clean時に削除するファイルを，ターゲット依存部で定義するための変数
   （CLEAN_FILES）を導入．

  ・ユーティリティの修正
    makereleaseが使うディレクトリ名（asp）を，カレントディレクトリか
    ら決定するように修正．
    makedepに，Cygwin環境におけるルートディレクトリ名を指定するため
    の-Rオプションを追加．MakefileにMAKEDEP_OPTS変数を追加．

  ・【ターゲット依存部】call_atexitの廃止
    call_atexitを廃止したため，ターゲット依存部から定義を削除する．
    call_atexitで行っていた処理（標準的にはsoftware_term_hookを呼び出
    す処理）は，必要であればtarget_exitの先頭で行う．

  ・【ターゲット依存部】makedepを呼ぶ際のオプションの追加
     Makefileのターゲット依存部（Makefile.target等）でmakedepを呼んで
     いる場合には，$(MAKEDEP_OPTS)を追加する．

     例）@$(PERL) $(SRCDIR)/utils/makedep -C $(CC) $(MAKEDEP_OPTS) \
             -O "$(CFLAGS) $(KERNEL_CFLAGS)" $< >> Makefile.depend

  ・【ターゲット依存部】テンプレート変数の値の設定の削除
     OMIT_INITIALIZE_INTERRUPTとOMIT_INITIALIZE_EXCEPTIONの2つのテンプ
     レート変数の値を，ヘッダファイルの定義から自動取得するように修正
     したため，ターゲット依存部（target.tfまたはそこからインクルードさ
     れるファイル）で値を定義していれば，その定義を削除する．

・システムインタフェースレイヤーAPIにプロセッサID取得APIのマクロを追加
  void sil_get_pid(uint_t *p_id)
    -> void sil_get_pid(ID *p_prcid)

・【ターゲット依存部】TOPPERS_MASTER_PRCID をカーネル共通構成マクロと
   して導入
  
・【ターゲット依存部】TOPPERS_SYSTIM_ADMIN_PRC_ID の名称変更
  TOPPERS_SYSTIM_PRCIDへ変更．

・ref_cyc/ref_almでのprcidの取得の追加

・グローバルタイマ方式時のエラーチェックの追加
  システム時刻管理プロセッサ以外へタイムイベントハンドラを登録した場合
  と，割付け可能プロセッサへシステム時刻管理プロセッサ以外を指定した場
  合にエラーとする．

・【ターゲット依存部】TOPPERS_SYSTIM_ADMIN_PRC_ID の導入
   システム時刻管理プロセッサのIDを指定．

・【ターゲット依存部】マクロ名の変更
    GENERATE_TMEVT_HEAP_G_KTIMER
    ->GENERATE_TMEVT_HEAP_SYSTIM_GLOBAL

    GENERATE_TEVTCB_G_KTIMER
    ->GENERATE_TEVTCB_SYSTIM_GLOBAL

・【ターゲット依存部】TTYPE_KTIMER の廃止
  コンフィギュレータの更新により，マクロのdefineが.tfで取得可能となっ
  たため廃止．

・コンフィギュレータの更新（1.5.0-a7_2009-4-24）
  クラスIDに一般定数式パラメータが指定可能に

・システムインタフェースレイヤーAPIにプロセッサID取得APIを追加

・バージョン番号の修正

・サンプルプログラムにmsta_cycとmsta_almを追加．

・【ターゲット依存部】システム時刻の管理方式のマクロをカーネル内部マク
  ロから，カーネル構成マクロに変更．

・ISR/初期化ルーチン/終了ルーチンに即値（アドレス）を指定した場合にエ
  ラーとなる問題を修正．
  
・psnd_pdq() でメッセージ送信後，受信待ちしていた受信タスクにディスパ
  ッチしない不具合の修正

・サービスコール単位でライブラリ化時のエラーの修正
  サービスコール単位でライブラリ化時に，giant_lockとext_ker_reqflgが
  多重定義となってしまう問題を修正．

・rcv_pdq/prcv_pdq/trcv_pdqでバッファがあり送信待ちタスクありのパスの
  修正
  送信待ちのタスクが持っていたデータをキューに登録するときの優先度
  が，rcv_dtq/trcv_dtqで渡したデータの優先度となっている．送信タスクが
  持っているデータで登録するように修正した．

・tmoutにTMO_POLが指定された場合の処理がない不具合の修正
  以下のAPIにおいて，tmoutにTMO_POLが指定された場合の処理がなかった．
  trcv_dtq/trcv_pdq/tsnd_pdq

・オブジェクトロックを解放せずにディスパッチしていていた不具合の修正
  以下のAPIにおいて，オブジェクトロックを解放せずにディスパッチしてい
  ていた．
    twai_sem/tsnd_dtq/trcv_mbx/trcv_pdq/tsnd_pdq

・ロックマクロの不具合修正
  以下の2種類のマクロに関して，ロック関数の戻り値の論理を反対としてい
  たため，修正．
  ACQUIRE_DUAL_TSK_LOCK/ACQUIRE_NESTED_TSK_LOCK_AND_CHECK_MIG(プロセッ
  サロック)

・【ターゲット依存部】CPU例外ハンドラからのリターン時のスピンロックの扱い
  CPU例外発生時にスピンロックを取得している場合は，リターン時に解放し
  ない．

・グローバルタイマ方式時のget_utmの無効化

・ref_spnの追加
  スピンロックの状態を参照する ref_spn を追加．

・スピンロック取得中のunl_cpu/iunl_cpu/loc_cpu/iloc_cpuの扱いの変更
  どのAPIもスピンロック取得中は呼び出すことは可能だが，状態は変化しな
  いように変更．

・mig_tskの仕様変更
  対象タスクが割り付けられているプロセッサと同一のプロセッサを指定した
  場合には，マイグレーションは発生しないが，優先順位が同一優先度のタス
  クの中で最低となるよう変更． 

・try_spnのエラーコードの変更
  ロックが取得できなかった場合のエラーコードをE_TMOUTからE_OBJに変更．

・ネイティブスピン方式の場合にスピンロックが不足した場合のエラーコード
  の変更
  E_NOIDからE_NORESに変更．  

・用語の変更
  マイグレーション制限 -> 割付け可能プロセッサ

・自タスクを指定した場合にE_OBJを返していた問題を修正
  can_act/get_pri/wup_tsk/can_wup/rsm_tsk/chg_pri
  FDMPカーネルからの移植時にterflgのチェックルーチンが残っていた．

・マクロ名の変更（CHECK_LCKSPN -> CHECK_LOCSPN）

・マクロ名の変更(PRC_INIT -> TPRC_INIT)
  他の定数との整合性のための変更．

・TLV対応
  ./arch/logtrace/trace_dump.c を変更．

・クラス3/4を有効にした場合のエラーの修正
  ./sysvc/logtask.c, ./syssvc/serial.c について，マクロ定義が間違って
  いたため，クラス3/4を定義するとエラーとなっていた．

・make_runnable()の変更
  タスク状態の変更を行なわないように変更．この変更により，マイグレーシ
  ョン先のプロセッサのキューに接続するさい，make_runnableを呼び出して
  も，タスクの状態が変更されたログを出力しないようになった．

・OMIT_KER_REQ_ON_IPIに関する修正
  OMIT_KER_REQ_ON_IPIが未定義の場合，initialize_pcb()で，
  ext_ker_reqflgを初期化していた問題を解決．

----------------------------------------------------------------------

        TOPPERS/FMPカーネル
        Release 0.A.0 から 0.B.0 への変更点
        リリース日時 2008-02-04

○変更点のリスト

・ドキュメントの整備
  ASPカーネルからの変更された点について記載した．

・カーネル内データのメモリ配置場所指定方法の変更
  ・コンフィギュレータに追加された関数機能を用いて，GNU環境以外もサポ
    ート可能なように変更．

・システムサービスのメモリ配置場所用マクロの変更
  ・GNU環境以外もサポート可能なように，セクションのみの指定から，変数
    の宣言自体をマクロで行うように変更．

・コンフィギュレーションファイルでのクラスIDのチェックを追加

・静的APIのエラーコードの変更

・非タスクコンテキスト用のスタックの構成を変更

・非タスクコンテキストのチェックルーチンの実装

・グローバルシステムログのスピンロックの変更
  silからカーネルのスピンロック機能を用いるように変更．

・処理単位からのリターン時にスピンロック解除状態とする． 
  ・タスク
  ・タスク例外処理ルーチン
  ・割込みハンドラ/割込みサービスルーチン/タイムイベントハンドラ
  ・CPU例外ハンドラ 

・カーネル内部シンボルのリネーム
  リネームされていなかったシンボルがあったため，リネーム．

・用語の統一
  "ロックの解放"に統一．  

・割込み関連の仕様変更
  統合仕様書のspecに準拠するように書き換え．

・初期化ルーチンと終了処理ルーチンの仕様変更
  クラスに属さないグローバル初期化ルーチンと終了処理ルーチンを導入  

・コメントの用語の変更 : 
  タスクのプロセッサへの"所属"から"割り付け"へ用語を変更．

・トレースログの拡充 : 
  全てのAPIとハンドラ実行の前後のトレースログの取得と，出力ルーチンを
  実装．

・タスクマイグレーションログの追加 : ./kernel/task.h ./kernel/task_manage.c
  タスクマイグレーション時にログを取得するように変更

・シスログの修正 : ./syssvc/syslog.c
  シスログで直接 prc_index() を使わないように変更

・エミュレーション方式のスピンロックの問題点の修正 : 
  ./kernel/kernel.tf, ./kernel/spin_lock.h, ./kernel/spin_lock.c
  エミュレーション方式の初期化ブロックと管理ブロックの構造が古かったた
  め，正しく動作しない問題を修正．

・kernel_cfg.cのISR生成ルーチンの修正 : ./kernel/kernel.tf
  割込み番号の上位ビットにプロセッサIDを付加する場合の割込みサービスル
  ーチンの生成が生成されなかった問題を修正．

・スピンロックオブジェクトの修正 : ./kernel/spin_lock.c
  エミュレーション方式の場合のinitialize_spin_lock()でのロック変数の
  初期化ルーチンが古いままであった点を修正．

・ロック取得ルーチンの修正　: ./kernel/mp.h
  非タスクコンテキスト用のリトライするロック取得ルーチンでリトライ時に
  割込みを許可していない箇所を修正．

・性能評価プログラムの追加 : ./perf
   act_tsk, mact_tsk, mig_tsk の性能評価プログラムを追加．

・テストプログラムの追加 : ./test
   1コアテスト，2コアmig_tskテスト，2コアmact_tskテストを追加．

・histgram.c のアップデート : ./library/histgram.c
   ターゲット依存部で定義したマクロ(HIST_GET_TIM)により計測可能とした．

・calltex()の修正 : ./kernel/task.c
   calltex()で，call_texrtn() ではなく，dispatch_call_texrtn() を呼び
   出すように修正．

・prc_index() と プロセッサIDの説明を追加 : ./doc/porting.txt
   prc_index()が返すべき値について，プロセッサIDの用途について説明を追
   加．

・ASP 1.3.2 追従
   ASP 1.3.1 -> 1.3.2 で変更された箇所をFMPにも反映

・コンフィギュレータの更新
   cfg-20081016.tar.gz に更新．

○ターゲット依存部の要修正箇所

----------------------------------------------------------------------

        TOPPERS/FMPカーネル
        Release 0.A.0 
        リリース日時 2008-05-12

○変更点のリスト

○ターゲット依存部の要修正箇所

----------------------------------------------------------------------
